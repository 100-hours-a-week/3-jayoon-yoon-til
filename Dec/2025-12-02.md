# 스크럼

## 1. 오늘의 주요 일정 (Events/Schedule)
- 네임스페이스, 컨피그맵과 시크릿
- 스토리지와 네트워킹 

## 2. 오늘 완수할 일 (Tasks)
- 13 Namespace
- 16 ConfigMap
- 17 Secret
- 18 Volume
- 19 PV/PVC
- 20 StroageClass
- 21 Networking
- 22 CNI(Container Network Interface)

## 3. 이슈 및 질문 (Blockers / R&D)
- 없음

# 새로 배운 내용

## 주제 1: Probe

- Probe
    1. ![startup probe](2025-12-02/image-5.png)
        - Liveness probe의 오작동을 막아줍니다.
        - 준비 되었다는 응답을 받으면 startup probe는 liveness나 Readiness probe에게 역할을 넘깁니다.
        - 실패했을 때는 컨테이너를 삭제해버립니다.
    2. ![Liveness Probe](2025-12-02/image.png)
        - 지속적인 생존을 확인한다. 실패했을 때는 컨테이너를 삭제해버린다. Pod는 살려둔다.
        - 예시: 무한루프, 데드락 탐지
    3. ![Readiness Probe](2025-12-02/image-1.png)
        - 트래픽 처리 가능 유무를 확인한다. Liveness와 달리 컨테이너를 삭제해버리지는 않는다.
        - 예시: 롤링 배포 시, DB 연결 대기
- ![Probe 진단 방법](2025-12-02/image-2.png)
    - ![exec](2025-12-02/image-3.png)
- ![컨테이너 탐지](2025-12-02/image-4.png)
    - 보통 CPU 잘 쓰고 있나 등을 확인하는데 데드락에 걸리면 CPU를 정말 제대로 사용하고 있다. 하지만 이런 경우가 정상인 경우가 아니므로 판별해야 한다. 실제 200~399 사이의 응답을 받는지를 확인한다.
- 프로젝트 별 Probe 설정
    - FE
        - probe는 5초 정도 마다 반복적으로 요청을 보내므로, 큰 용량의 정적 파일을 응답 받는 
        - ![alt text](2025-12-02/image-6.png)
    - BE
        - 부팅 시간이 긴 spring 같은 경우에는 Stratup probe를 무조건 사용합니다.
        - express라도 의존성을 갖고 있으므로 이를 확인하기 위해 startup probe를 사용합니다.
        - ![alt text](2025-12-02/image-7.png)
        - ![startup](2025-12-02/image-8.png)
        - ![liveness](2025-12-02/image-9.png)
            - 자주 요청을 보내기 떄문에 가볍게 설정해야 한다.
        - ![readiness](2025-12-02/image-10.png)
            - 꼼꼼하게 설정해야 한다.
    - DB
        - 아주 보수적으로 접근한다.
        - DB는 오래 걸리므로 응답을 못 받았을 때 컨테이너를 지워버리는 probe를 사용하는 것은 알맞지 않다.
        - ![특징](2025-12-02/image-11.png)
        - ![readiness](2025-12-02/image-12.png)

## Namespace
- 자원할당이 주목적입니다.
- 회사에서는 namespace를 할당해두고, 각 팀 마다 사용할 수 있는 할당량을 설정해둡니다.
- 분리한 namespace끼리 설정을 하면 의사소통이 가능하기도 하다.
- ![회사에서의 팀 별 분리하는 예시](2025-12-02/image-13.png)

## ConfigMap
- 보여도 되는 환경변수
- 이를 pod 형태로 해서 사용하려면 사용하는 곳에서 굉장히 많은 양의 텍스트를 적어야 한다. 때문에 이렇게 하지 않고, 파일로 넘겨버린다.

## Secret
- 외부에 보이면 안 되는 것들(비번번호, ssl 관련 파일)을 사용한다.
- Base64로 인코딩 되었다고 가정한다. 때문에 pod에서 이를 디코딩하는 과정을 무건건 진행한다. 그러므로 인코딩 되어 있는 값을 넣어야 한다.
    - Base64는 암호화가 아니다. 단순히 인코딩, 디코딩이다.
    - secret.yaml 파일은 github에 업로드 하지 않는다.
- etcd에 저장 되어 관되된다.
    - etcd에 들어가는 정보들은 전부 암호화 된다.
- 역할로 인한 접근통제가 이뤄진다.(RBAC)

## ConfigMap vs Secret
- ![차이 표](2025-12-02/image-14.png)

## Volume
- 파드가 사라지면 사라지는 volume, 이를 해결하기 위해 아래 PV가 나왔다.
- ![volume 종류](2025-12-02/image-15.png)
- 볼륨 유형
    - EmptyDir
        - ![emptyDir](2025-12-02/image-16.png)
        - 파드 안에 공용 볼륨을 만든 것이기 때문에 파드 삭제하면 같이 삭제됨
        - ![실무 활용 예시](2025-12-02/image-19.png)
            - ![alt text](2025-12-02/image-20.png)
            - pod3, 컨테이너 두 개에 db 하나(???, db가 아니라 다른 것일 수도 있음)
        
    - hostPath
        - docker host volume mount와 비슷하다.
        - ![hostPath 특징](2025-12-02/image-17.png)
        - ![실무에서는 잘 사용하지 않음](2025-12-02/image-18.png)

## PV/PVC
- ![사용 사례](2025-12-02/image-21.png)
    - S3는 트래픽이 나오니 이를 이용할 수도 있음
    - 컨테이너로
- 쿠버네티스나 컨테이너에서 DB 만들지 않고, AWS RDS 사용하는 이유
    - DB를 직접 관리하기 싫어서
        - 죽었을 때 살리려면 기다려야 함.
        - 죽으면 그동안의 데이터는 잃어버림

## Networking
- BGP
    - P2P 방식으로 모든 요소에 IP를 부여하고, NAT를 사용하려 하지 않음. 모두 Cluster 내부에 있기 때문에 NAT를 사용할 필요가 없음
    - NAT는 테이블에 사설 IP를 주면 공인IP를 넘겨주는 형식이다.
    - 각 요소 마다 자신과 연결된 요소의 IP를 알고 있다.
    - ![BGP 방식](2025-12-02/image-22.png)
    - 필터링을 걸거나 라우팅을 다른 방식으로 설정을 줄 수 있다.
        - 설정하기 복잡하지만 더 디테일한 설정이 가능하므로 실무에서 많이 사용된다.
- k8s의 목표
    - ![목표](2025-12-02/image-23.png)
    - 우리 클러스터 내에서 통신하는데 굳이 NAT가 필요한가?
    - 다른 네트워크의 사설IP로의 통신을 하기 위해 NAT를 통해 공인IP를 받는 것인데 우리는 같은 클러스터 내에 있는 엔드포인트끼리만 통신하는 상황이다.
        - Flat Network가 k8s의 목표점이다.
- k8s의 통신 방식
    - ![클러스터 내의 통신 방식](2025-12-02/image-24.png)
    - ![파드 특징 및 서비스 역할](2025-12-02/image-25.png)
        - ![서비스의 역할](2025-12-02/image-26.png)
    - ![kube-proxy의 역할](2025-12-02/image-27.png)
        - ![alt text](2025-12-02/image-28.png)
- network 생성 순서
    - ![VXLAN이든 BGP이든 여기까지는 동일한 방식!](2025-12-02/image-31.png)
        - ![이전1, 파드 생성, kubelet에게 잘 생성 되었다고 알림, Master에게 보고](2025-12-02/image-30.png)
        - ![이전2](2025-12-02/image-29.png)
- 서비스 네트워크가 VXLAN이다.
- flannel은 ip를 만들어주고, 어딘가로 발사해준다?

# 오늘의 도전 과제와 해결 방법

- 도전 과제 1: 도전 과제에 대한 설명 및 해결 방법

# 오늘의 회고

- 성공적인 점, 개선해야 할 점, 새롭게 시도하고 싶은 방법 등을 포함할 수 있습니다.

# 참고 자료 및 링크

- [링크 제목](URL)
